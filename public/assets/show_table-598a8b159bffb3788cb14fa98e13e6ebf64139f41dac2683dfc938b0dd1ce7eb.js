function chtoi(e){switch(e){case"x":case"X":return 24;case"y":case"Y":return 25;case"m":case"M":return 26;default:return parseInt(e,10)}}var app=angular.module("app",["ngTouch","ui.grid","ui.grid.cellNav","ui.grid.resizeColumns","ui.grid.selection","ui.grid.moveColumns"]);app.controller("MainCtrl",["$scope","$http","$timeout","$interval","uiGridConstants","$sce",function(e,i){e.gridOptions={enableSorting:!0,enableColumnResizing:!0,enableFiltering:!0,enableGridMenu:!0,headerRowHeight:200,showGridFooter:!1,showColumnFooter:!1,rowIdentity:function(e){return e.id},getRowIdentity:function(e){return e.id},onRegisterApi:function(i){e.gridApi=i},columnDefs:[{displayName:"Chrom. Pos",name:"x",width:140,sortingAlgorithm:function(i,n){var t=e.gridApi.core.sortHandleNulls(i,n);return null!==t?t:(aa=i.split(":"),ba=n.split(":"),ac=chtoi(aa[0]),bc=chtoi(ba[0]),ac<bc?-1:ac>bc?1:(ap=parseInt(aa[1],10),bp=parseInt(ba[1],10),ap<bp?-1:ap>bp?1:0))}},{displayName:"ID",name:"i",width:140,cellTemplate:'<div class="ui-grid-cell-contents"><a href ng-click="grid.appScope.show_rs(row.entity.i)">{{COL_FIELD}}</a></div>'},{displayName:"Gene",name:"ge",width:110,cellTemplate:'<div class="ui-grid-cell-contents"><a href ng-click="grid.appScope.show_gene(row.entity.ge)">{{COL_FIELD}}</a></div>'},{displayName:"Ref",name:"r",width:80,displaySubTitle:"Foo"},{displayName:"Genotype",name:"g",width:130},{displayName:"PEDIA",name:"p",width:95,type:"number",sort:{direction:"desc"}},{displayName:"CADD",name:"s",width:90,type:"number",sort:{direction:"desc"}},{displayName:"Effect/HGVS",name:"e",width:200,cellTemplate:'<div class="ui-grid-cell-contents" title="{{row.entity.h}}"><span>{{COL_FIELD}}</span></div>'},{displayName:"Significance",name:"cs_score",width:120,type:"number",cellTemplate:'<div class="ui-grid-cell-contents"><span title="{{grid.appScope.getSigString(COL_FIELD)}}"><img ng-src="{{grid.appScope.getTemplate(COL_FIELD)}}" width=100 height=20/></span></div>'},{displayName:"",name:"review",width:30,enableColumnMenu:!1,enableFiltering:!1,enableSorting:!1,cellClass:"noborder",cellTemplate:'<div class="ui-grid-cell-contents"><span title="Review"><img ng-src="{{grid.appScope.getView}}" width=20 height=20 ng-click="grid.appScope.clicked(row.entity)" /></span></div>'},{displayName:"",name:"igv",width:25,enableColumnMenu:!1,enableSorting:!1,enableFiltering:!1,cellClass:"noborder",cellTemplate:'<div class="ui-grid-cell-contents" title="Open IGV"><span><img ng-src="{{grid.appScope.getIgv}}" width=20 height=20 ng-click="grid.appScope.igv_clicked(row.entity.x)" /></span></div>'}]},e.getSigString=function(e){switch(result="",e){case 1:result="Benign";break;case 2:result="Likley benign";break;case 3:result="Uncertain significance";break;case 4:result="Likely pathogenic";break;case 5:result="Pathogenic";break;default:result=""}return result},e.getTemplate=function(e){return"/assets/star_"+e+".png"},e.getIgv="/assets/igv.png",e.getView="/assets/sharp-visibility-24px.svg",e.show_rs=function(e){rs=e.match(/^rs(\d+)/),rs?url="http://www.ncbi.nlm.nih.gov/projects/SNP/snp_ref.cgi?rs="+rs[0]:url="http://www.ncbi.nlm.nih.gov/projects/SNP/snp_ref.cgi?rs=",window.open(url,"_blank")},e.show_gene=function(e){url="http://www.genecards.org/cgi-bin/carddisp.pl?gene="+e,window.open(url,"_blank")},e.clicked=function(e){url="/review?chr="+e.x+"&snp="+e.i+"&hgvs="+e.h+"&genotype="+e.g+"&ref="+e.r+"&mut="+e.m+"&vcf="+e.v+"&gene_id="+e.gene_id+"&cadd="+e.s,window.open(url,"_blank")},e.igv_clicked=function(e){url="http://localhost:60151/goto?locus=chr"+e,window.open(url,"_blank")},url="/vcf_files/get_var/"+gon.vcf_id,i.get(url).success(function(i){e.gridOptions.data=i.variants,$("#var_num").append(i.var_num)})}]).directive("gridLoading",function(){return{restrict:"C",require:"^uiGrid",link:function(e,i,n,t){e.grid=t.grid}}});